<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux | Ankush Choubey</title>
<meta name="generator" content="Jekyll v4.1.1">
<meta property="og:title" content="Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux">
<meta property="og:locale" content="en_US">
<meta name="description" content="I faced a unique problem and it is worth writing about. The cause was parallel access and saving of a single document that caused OptimisticLockingException.">
<meta property="og:description" content="I faced a unique problem and it is worth writing about. The cause was parallel access and saving of a single document that caused OptimisticLockingException.">
<link rel="canonical" href="https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/">
<meta property="og:url" content="https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/">
<meta property="og:site_name" content="Ankush Choubey">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-04-16T00:00:00-05:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-16T15:52:08-05:00","datePublished":"2022-04-16T00:00:00-05:00","description":"I faced a unique problem and it is worth writing about. The cause was parallel access and saving of a single document that caused OptimisticLockingException.","headline":"Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/"},"url":"https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
<link type="application/atom+xml" rel="alternate" href="https://www.ankushchoubey.com/feed.xml" title="Ankush Choubey">
<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-35993343-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>



<script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/787ccdfb3a0c625c1830ac78a/859c6d3b694fad02c3eff1603.js");</script><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux | Ankush Choubey</title>
<meta name="generator" content="Jekyll v4.1.1">
<meta property="og:title" content="Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux">
<meta property="og:locale" content="en_US">
<meta name="description" content="I faced a unique problem and it is worth writing about. The cause was parallel access and saving of a single document that caused OptimisticLockingException.">
<meta property="og:description" content="I faced a unique problem and it is worth writing about. The cause was parallel access and saving of a single document that caused OptimisticLockingException.">
<link rel="canonical" href="https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/">
<meta property="og:url" content="https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/">
<meta property="og:site_name" content="Ankush Choubey">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2022-04-16T00:00:00-05:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-04-16T15:52:08-05:00","datePublished":"2022-04-16T00:00:00-05:00","description":"I faced a unique problem and it is worth writing about. The cause was parallel access and saving of a single document that caused OptimisticLockingException.","headline":"Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/"},"url":"https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet">
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css">
<link type="application/atom+xml" rel="alternate" href="https://www.ankushchoubey.com/feed.xml" title="Ankush Choubey">
<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-35993343-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body>
<header class="site-header">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Ankush Choubey</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/core-values-page/">Core Values</a><a class="page-link" href="/philosophy/">Life &amp; Self Improvement</a><a class="page-link" href="/resume">Hire me!</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/tdd/">Test First Test Everything</a>
</div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <style>
  .page-content{
    padding-top: 0px;
  }
  .post-header{
    display: flex;
    flex-direction: column;
    justify-content: end;}

  .cover-image{
    position: absolute;
    left:0px;
    height: 300px;
    object-fit: cover;
    width: 100%;
  }

  @media screen and (max-width: 500px) {
    .post-header{}
    .cover-image{
      height: 550px;
    }
  }
  .post-header-content{}
</style>

<header class="post-header"><div class="post-header-content">
    <h1 class="post-title p-name" itemprop="name headline">Solving a OptimisticLockingException During Upsert in MongoDB-Spring Webflux</h1>
<p class="post-meta post-meta-title"><time class="dt-published" datetime="2022-04-16T00:00:00-05:00" itemprop="datePublished">
        Apr 16, 2022
      </time>
      • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
    <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i>
      
      <a class="category-tags-link" href="/categories/#database">database</a>
       
      
      <a class="category-tags-link" href="/categories/#mongodb">mongodb</a>
       
      
      <a class="category-tags-link" href="/categories/#spring-boot">spring-boot</a>
       
      
      <a class="category-tags-link" href="/categories/#tdd">tdd</a>
       
      
      <a class="category-tags-link" href="/categories/#tdd-example">tdd-example</a>
      
      
    </p>
    

    </div>
</header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
     
    <div class="flash announce-block">
    <svg class="octicon octicon-megaphone" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><g fill-rule="evenodd"><path d="M3.25 9a.75.75 0 01.75.75c0 2.142.456 3.828.733 4.653a.121.121 0 00.05.064.207.207 0 00.117.033h1.31c.085 0 .18-.042.258-.152a.448.448 0 00.075-.366A16.74 16.74 0 016 9.75a.75.75 0 011.5 0c0 1.588.25 2.926.494 3.85.293 1.113-.504 2.4-1.783 2.4H4.9c-.686 0-1.35-.41-1.589-1.12A16.42 16.42 0 012.5 9.75.75.75 0 013.25 9z"></path><path d="M0 6a4 4 0 014-4h2.75a.75.75 0 01.75.75v6.5a.75.75 0 01-.75.75H4a4 4 0 01-4-4zm4-2.5a2.5 2.5 0 000 5h2v-5H4z"></path><path d="M15.59.082A.75.75 0 0116 .75v10.5a.75.75 0 01-1.189.608l-.002-.001h.001l-.014-.01a5.829 5.829 0 00-.422-.25 10.58 10.58 0 00-1.469-.64C11.576 10.484 9.536 10 6.75 10a.75.75 0 110-1.5c2.964 0 5.174.516 6.658 1.043.423.151.787.302 1.092.443V2.014c-.305.14-.669.292-1.092.443C11.924 2.984 9.713 3.5 6.75 3.5a.75.75 0 110-1.5c2.786 0 4.826-.484 6.155-.957.665-.236 1.154-.47 1.47-.64a5.82 5.82 0 00.421-.25l.014-.01a.75.75 0 01.78-.061zm-.78.06zm.44 11.108l-.44.607.44-.607z"></path></g></svg>
    <strong>Announcement: </strong> <a href="https://www.ankushchoubey.com/tdd">This blog post part of my free 'Test First Test Everything' series. Explore the complete series for comprehensive insights and guidance.     
        <img style="
        background: #f0f8ff00;
        max-width: 300px;" src="/images/tdd.png">
    </a>
</div>


  
  <div class="post-content e-content" itemprop="articleBody">
    <p>I faced a unique problem and it is worth writing about. The cause was parallel access and saving of a single document that caused <code class="language-plaintext highlighter-rouge">OptimisticLockingException</code>.</p>

<h1 id="problem"><strong>Problem</strong></h1>

<p>I had a <code class="language-plaintext highlighter-rouge">@Document</code> which had to be manupilated.</p>

<p>The <code class="language-plaintext highlighter-rouge">@Document</code> had a repository which extended <code class="language-plaintext highlighter-rouge">ReactiveMongoRepository</code>.</p>

<p>So it was something like this</p>

<p><strong>SampleDocument.java</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Document</span><span class="o">(</span><span class="s">"sample_document"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">SampleDocument</span><span class="o">{</span>
    <span class="nd">@Version</span>
    <span class="nc">Long</span> <span class="n">version</span><span class="o">;</span>

    <span class="nd">@Indexed</span><span class="o">(</span><span class="n">backgroud</span><span class="o">=</span><span class="kc">true</span><span class="o">)</span>
    <span class="nc">String</span> <span class="n">customId</span><span class="o">;</span>

    <span class="nc">String</span> <span class="n">fieldToBeModified</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p>Notice <code class="language-plaintext highlighter-rouge">@Version</code> annotation</p>

<p><strong>SampleRepository.java</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">interface</span> <span class="nc">SampleRepository</span> <span class="kd">extends</span> <span class="nc">ReactiveMongoRepository</span> <span class="o">&lt;</span><span class="nc">SampleDocument</span><span class="o">&gt;{</span>
    <span class="nc">Mono</span><span class="o">&lt;</span><span class="nc">SampleDocument</span><span class="o">&gt;</span> <span class="nf">findByCustomId</span><span class="o">(</span><span class="nc">String</span> <span class="n">customId</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>

<p>To update the document I had webflux code written like this:</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">repository</span><span class="o">.</span><span class="na">findByCustomId</span><span class="o">(</span><span class="n">someString</span><span class="o">)</span>   <span class="c1">// Step 1</span>
<span class="o">.</span><span class="na">flatmap</span><span class="o">(</span><span class="n">sampleDocument</span><span class="o">-&gt;{</span>
    <span class="c1">// manipulation of document         // Step 2</span>
    <span class="k">return</span> <span class="nc">Mono</span><span class="o">.</span><span class="na">just</span><span class="o">(</span><span class="n">sampleDocument</span><span class="o">)</span>
<span class="o">})</span>
<span class="o">.</span><span class="na">flatmap</span><span class="o">(</span><span class="n">sampleDocument</span> <span class="o">-&gt;</span> 
    <span class="n">repository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">sampleDocument</span><span class="o">)</span>     <span class="c1">// Step 3</span>
<span class="o">);</span> 
</code></pre></div></div>

<p>As you can see, the code to fetch the document (Step 1) and to save (Step 3) back are two separate lines. Between the lines are steps to manipulate the document (Step 2).</p>

<p>This was what caused the problem.</p>

<p>MongoDB uses version field in a document to maintain Locking. If the current <code class="language-plaintext highlighter-rouge">version</code> is <code class="language-plaintext highlighter-rouge">10</code> and you try to save <code class="language-plaintext highlighter-rouge">8</code> then this would lead to <code class="language-plaintext highlighter-rouge">OptimisticLockingException</code>.</p>

<p>In a concurrent environment like webflux when multiple thread are reading from the same data, it’s highly likely that the order the record is updated by some other thread before the current thread saves the data again.</p>

<p>This would specially be true where there are lots of upsert/update queries.</p>

<h1 id="solution"><strong>Solution</strong></h1>

<p>To fix this I switched to manually writing an update query and executing with <code class="language-plaintext highlighter-rouge">MongoOperation</code>.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">Update</span> <span class="n">updateQuery</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Update</span><span class="o">().</span> <span class="c1">// code to update document</span>

<span class="k">return</span> <span class="n">mongoOperation</span><span class="o">.</span><span class="na">findAndModify</span><span class="o">(</span><span class="n">query</span><span class="o">(</span><span class="n">where</span><span class="o">(</span><span class="s">"custom_id"</span><span class="o">).</span><span class="na">is</span><span class="o">(</span><span class="n">someString</span><span class="o">)),</span> <span class="n">updateQuery</span><span class="o">,</span> <span class="n">options</span><span class="o">().</span><span class="na">returnNew</span><span class="o">(</span><span class="kc">true</span><span class="o">).</span><span class="na">upsert</span><span class="o">(</span><span class="kc">true</span><span class="o">),</span> <span class="nc">SampleDocument</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
</code></pre></div></div>

<p>Instead of 2 different DB actions. It became one DB Action.</p>

<p>The update query does not need to bring data back to Webflux server to manipulate the document. The document is manipulated at Database only. The database is therefore responsible for ordering the updates which was fine in my case.</p>

<h1 id="extra-finding-root-cause-and-fixing-with-tdd">
<strong>Extra</strong>: Finding root cause and fixing with TDD</h1>

<p>I’m gonna try to provide examples of TDD wherever possible.</p>

<p>To find the cause, I suspected the data was being saved parallelly.</p>

<p>So I created a unit test as follows.</p>

<ol>
  <li>Manipulate documents parallel. This was done with <code class="language-plaintext highlighter-rouge">@RepeatableTest</code> and <code class="language-plaintext highlighter-rouge">@Execution(CONCURENT)</code>
</li>
  <li>Assertion wasn’t straight forward with <code class="language-plaintext highlighter-rouge">@RepeatableTest</code> so I instead collected all version in a static list.</li>
  <li>After all <code class="language-plaintext highlighter-rouge">@RepeatableTests</code> were over I asserted if version was as expected.</li>
  <li>I ran the code and saw <code class="language-plaintext highlighter-rouge">OptimisticLockingException</code> occuring and assertion failing.</li>
  <li>I replaced <code class="language-plaintext highlighter-rouge">repository</code> <code class="language-plaintext highlighter-rouge">find</code> and <code class="language-plaintext highlighter-rouge">save</code> with <code class="language-plaintext highlighter-rouge">MongoOperation</code> <code class="language-plaintext highlighter-rouge">update</code> as described above.</li>
  <li>The test passed.</li>
</ol>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Nested</span>
<span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"WHEN upsert is called parallely"</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">WhenUpsertIsCalledParallelyTest</span><span class="o">{</span>
    
    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">Long</span> <span class="n">repeatTimes</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Long</span><span class="o">&gt;</span> <span class="n">allVersions</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="nd">@RepeatableTest</span><span class="o">(</span><span class="n">repeatTimes</span><span class="o">)</span>                           <span class="c1">// Part of Step 1</span>
    <span class="nd">@Execution</span><span class="o">(</span><span class="no">CONCURRENT</span><span class="o">)</span>                                 <span class="c1">// Part of Step 1</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"SHOULD manipulate a single record"</span><span class="o">)</span>
    <span class="kt">void</span> <span class="nf">shouldManipulateASingleRecord</span><span class="o">(){</span>
        <span class="c1">// when:</span>
            <span class="nc">SampleDocument</span> <span class="n">document</span> <span class="o">=</span> <span class="n">myService</span><span class="o">.</span><span class="na">upsert</span><span class="o">(</span><span class="n">someString</span><span class="o">).</span><span class="na">block</span><span class="o">();</span> <span class="c1">// Part of Step 1</span>
        <span class="c1">// data collection:</span>
            <span class="n">allVersions</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">document</span><span class="o">.</span><span class="na">getVersion</span><span class="o">());</span>         <span class="c1">// Part of Step 2</span>
    <span class="o">}</span>

    <span class="nd">@AfterAll</span>
    <span class="kd">static</span> <span class="kt">void</span> <span class="nf">assertVersionIsRepeatTimes</span><span class="o">(){</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="nc">Collections</span><span class="o">.</span><span class="na">max</span><span class="o">(</span><span class="n">version</span><span class="o">))</span>                <span class="c1">// Part of Step 3</span>
            <span class="o">.</span><span class="na">isEqualTo</span><span class="o">(</span><span class="n">repeatTimes</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

  </div>
     
    <div class="flash announce-block">
    <svg class="octicon octicon-megaphone" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><g fill-rule="evenodd"><path d="M3.25 9a.75.75 0 01.75.75c0 2.142.456 3.828.733 4.653a.121.121 0 00.05.064.207.207 0 00.117.033h1.31c.085 0 .18-.042.258-.152a.448.448 0 00.075-.366A16.74 16.74 0 016 9.75a.75.75 0 011.5 0c0 1.588.25 2.926.494 3.85.293 1.113-.504 2.4-1.783 2.4H4.9c-.686 0-1.35-.41-1.589-1.12A16.42 16.42 0 012.5 9.75.75.75 0 013.25 9z"></path><path d="M0 6a4 4 0 014-4h2.75a.75.75 0 01.75.75v6.5a.75.75 0 01-.75.75H4a4 4 0 01-4-4zm4-2.5a2.5 2.5 0 000 5h2v-5H4z"></path><path d="M15.59.082A.75.75 0 0116 .75v10.5a.75.75 0 01-1.189.608l-.002-.001h.001l-.014-.01a5.829 5.829 0 00-.422-.25 10.58 10.58 0 00-1.469-.64C11.576 10.484 9.536 10 6.75 10a.75.75 0 110-1.5c2.964 0 5.174.516 6.658 1.043.423.151.787.302 1.092.443V2.014c-.305.14-.669.292-1.092.443C11.924 2.984 9.713 3.5 6.75 3.5a.75.75 0 110-1.5c2.786 0 4.826-.484 6.155-.957.665-.236 1.154-.47 1.47-.64a5.82 5.82 0 00.421-.25l.014-.01a.75.75 0 01.78-.061zm-.78.06zm.44 11.108l-.44.607.44-.607z"></path></g></svg>
    <strong>Announcement: </strong> <a href="https://www.ankushchoubey.com/tdd">This blog post part of my free 'Test First Test Everything' series. Explore the complete series for comprehensive insights and guidance.     
        <img style="
        background: #f0f8ff00;
        max-width: 300px;" src="/images/tdd.png">
    </a>
</div>


  <div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
<style type="text/css">
      #mc_embed_signup{background:#fff; false;clear:left; font:14px Helvetica,Arial,sans-serif; width: 600px;}
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
    <img src="/images/signup-homescreen.png" style="background: #0000ff00;max-height: 150px;">
    <a style="font-size: 1px;" href="https://www.freepik.com/free-vector/hacker-operating-laptop-cartoon-icon-illustration-technology-icon-concept-isolated-flat-cartoon-style_11602236.htm#query=programmer&amp;position=1&amp;from_view=search&amp;track=sph">Image by catalyststuff  on Freepik</a>
  <form action="https://ankushchoubey.us21.list-manage.com/subscribe/post?u=787ccdfb3a0c625c1830ac78a&id=51f57ce68a&f_id=002959e1f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank">
    <p style="display: flex;margin: 0px !important;gap: 10px;">
        Hire me for consulting, speaking and developer roles by contacting me on <a href="https://www.linkedin.com/in/ankushchoubey/"><img src="/images/LI-Logo.png" style="height: 2ch;    background: #f0f8ff00;" alt="LinkedIn logo"></a>.
    </p>  
    <div id="mc_embed_signup_scroll">
<p>For more articles like this one, subcribe to my email newsletter for captivating articles at the crossroads of Software Engineering and Philosophy.</p>
          <div class="indicates-required" style="display: none;">
<span class="asterisk">*</span> indicates required</div>
          <div class="mc-field-group">
<label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""><span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span>
</div>
      <div id="mce-responses" class="clear foot">
          <div class="response" id="mce-error-response" style="display: none;"></div>
          <div class="response" id="mce-success-response" style="display: none;"></div>
      </div>
  <div aria-hidden="true" style="position: absolute; left: -5000px;">
      /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
      <input type="text" name="b_787ccdfb3a0c625c1830ac78a_51f57ce68a" tabindex="-1" value="">
  </div>
      <div class="optionalParent">
          <div class="clear foot">
              <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
              <p class="brandingLogo" style="margin: 0px auto;"><a href="http://eepurl.com/iwHRjY" title="Mailchimp - email marketing made easy and fun"><img src="https://eep.io/mc-cdn-images/template_images/branding_logo_text_dark_dtp.svg" alt="referral badge"></a></p>
          </div>
      </div>
  </div>
</form>
</div>
<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
</div>

<style>
div#mc_embed_signup{
    width: auto !important;
    display: flex;
    justify-content: center;
    align-content: center;
}
form#mc_embed_signup{
    max-width: 800px !important;
}
#mc_embed_signup{
    background-color: #fff0 !important;
}
#mc_embed_signup .mc-field-group{
    padding-bottom: 0% !important;
}

#mc_embed_signup h2{
    margin: 0px !important;
}
#mc_embed_signup .brandingLogo{
    display: none !important;
}
</style>
<div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/';
      this.page.identifier = 'https://www.ankushchoubey.com/optimistic-locking-exception-mongodb/';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://ankushchoubey.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a class="u-url" href="/optimistic-locking-exception-mongodb/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://www.ankushchoubey.com/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Full Stack Developer - Cloud/Microservices</p>
      </div>
    </div>

    <div class="social-links">
<ul class="social-media-list">
<li>
  <a rel="me" href="https://github.com/ankschoubey" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/ankschoubey" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
