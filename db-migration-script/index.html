<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!-- <script>
  for (const iterator of document.getElementsByClassName('page-link')) {
      if (iterator.innerHTML === 'Search'){ iterator.classList.add('search-button'); iterator.title = 'Search';}
      if (iterator.innerHTML === 'Tags'){ iterator.classList.add('tags-button'); iterator.title = 'Tags';}
      if (iterator.innerHTML === 'Side Projects'){ iterator.classList.add('side-project-button'); iterator.title = 'Side Projects';}
  }
</script> --><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="/assets/accordian.js"></script>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Migrating DB smoothly with a migration script</h1>

    <p class="post-meta post-meta-title"><time class="dt-published post-meta-created-date" datetime="2023-03-03T00:00:00-06:00" itemprop="datePublished">
        Written: Mar 3, 2023
      </time>~<time class="dt-modified post-meta-last-modified-date" datetime="2023-03-03T14:52:08-06:00" itemprop="dateModified">
          Updated: Mar 3, 2023
        </time>
       • <span class="read-time" title="Estimated read time">
    
    
      1 min read
    
</span></p>    <style>
        .post-tool-bar{
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0px 10px 0px;
            /* border: 1px solid #e8e8e8; */
            border-width: 0px 0px 1px 0px;
        }
        .left-section , .right-section{
            display: flex;
            gap: 8px;
        }

    </style>
    
    <div class="post-tool-bar">
<!-- <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
        AOS.init();
</script> -->

<div class="tag-list">
    
    <a class="tag fa fa-hashtag database" href="/categories/#database">database</a>
    
</div>
<div class="right-section">
<a id="translate-btn" href="https://www.translatetheweb.com/?ref=TAns&from=&to=hi&a=https%3A%2F%2Fwww.ankushchoubey.com%2F">
    <img src="/images/icons/translate.svg" alt="Translate" style="width:35px">
</a>


<script>
    a = document.getElementById('translate-btn');
    a.setAttribute("href", "https://www.translatetheweb.com/?ref=TAns&from=&to=hi&a=" + window.location.href);
</script><a id="speech-btn">
    <img src="/images/icons/ear.svg" alt="listen" style="width:35px; cursor: pointer;">
</a>

<script>
    speakPost = () => {
        var msg = new SpeechSynthesisUtterance();
        const title = document.querySelector("h1.post-title.p-name").innerText;
        const post = document.querySelector("div.post-content.e-content").innerText
        msg.text = title + '.' + post;
        window.speechSynthesis.speak(msg);
    }
    if ('speechSynthesis' in window) {
        document.getElementById("speech-btn").addEventListener("click", speakPost);
    } else {
        document.getElementById('speech-btn').style.display = 'none';
    }
</script>

<!-- https://www.alebalweb-blog.com/85-text-to-speech-player-with-buttons-play-pause-stop-and-voice-choice.html -->
</div>
      
          
    </div>
    
</header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>If you are transferring from one DB to another and want to make sure it happens properly, this is the mechanism you can use.</p>

<p>The same mechanism could be used to migrate multiple tables. And can be implemented in SQL stored procedure or stored procedure equivalent in the DB of your choice.</p>

<ol>
  <li>Add these additional columns to your source table
    <ol>
      <li>
<strong>is_migrated</strong>: default false</li>
      <li><strong>migrated_date</strong></li>
      <li><strong>is_error</strong></li>
      <li><strong>error_description</strong></li>
    </ol>
  </li>
  <li>Create a DB migration script which
    <ol>
      <li>Copies a batch of data from one table in source DB to one table in dB.</li>
      <li>The batch size could be 1000. You don’t want the batch size to be too small because it could be slow. You don’t want it too high to be able to recover better.</li>
      <li>Whenever a batch is a complete update the is_migrated and migrated_date in the source DB. Then pick up the next batch where is_migrated is false.</li>
      <li>If there is an error, set <strong>is_error</strong> to_ true _and add <strong>error_description</strong>.</li>
      <li>The <strong>error_description</strong> could be an exception that is thrown.</li>
      <li>Once the script is done, check for <strong>is_error: true</strong> and fix those errors in the script itself.</li>
    </ol>
  </li>
  <li>Running
    <ol>
      <li>Run the script by copying the data from PROD to your testing environment.</li>
      <li>Fix your scripts if you find <strong>is_error: true</strong>
</li>
      <li>Once all is fixed, re-copy data from PROD to your testing environment and run again.</li>
      <li>You want to make sure everything works perfectly so that you won’t have to do much during the PROD run.</li>
      <li>Once you find all bugs are fixed, run the migration script in <strong>PROD</strong>.</li>
    </ol>
  </li>
</ol>

  </div>
  <!-- https://david.elbe.me/jekyll/2015/06/20/how-to-link-to-next-and-previous-post-with-jekyll.html -->

<div class="PageNavigation">
    
      <a class="prev" href="/v1/my-core-beliefs/">« My Core Beliefs from Feb 2023</a>
    
    
      <a class="next" href="/v1/oauth-scopes">Defining Scopes for your OAuth Service »</a>
    
  </div>

<style>
    .PageNavigation {
  font-size: 14px;
  display: block;
  width: auto;
  overflow: hidden;
}

.PageNavigation a {
  display: block;
  width: 50%;
  float: left;
  margin: 1em 0;
}

.PageNavigation .next {
  text-align: right;
}
</style>
<!-- from https://github.com/utterance/utterances -->
<!-- <script src="https://utteranc.es/client.js"
        repo="ankschoubey/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script> -->

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://www.ankushchoubey.com/db-migration-script/';
      this.page.identifier = 'https://www.ankushchoubey.com/db-migration-script/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://ankushchoubey.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a class="u-url" href="/db-migration-script/" hidden></a>
</article>
</head></html>
