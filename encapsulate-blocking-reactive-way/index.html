<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!-- <script>
  for (const iterator of document.getElementsByClassName('page-link')) {
      if (iterator.innerHTML === 'Search'){ iterator.classList.add('search-button'); iterator.title = 'Search';}
      if (iterator.innerHTML === 'Tags'){ iterator.classList.add('tags-button'); iterator.title = 'Tags';}
      if (iterator.innerHTML === 'Side Projects'){ iterator.classList.add('side-project-button'); iterator.title = 'Side Projects';}
  }
</script> --><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="/assets/accordian.js"></script>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Encapsulate Blocking Call the Reactor Way</h1>

    <p class="page-description">Notes from Avoiding Reactor Meltdown</p>
<p class="post-meta post-meta-title"><time class="dt-published post-meta-created-date" datetime="2022-08-15T00:00:00-05:00" itemprop="datePublished">
        Written: Aug 15, 2022
      </time>~<time class="dt-modified post-meta-last-modified-date" datetime="2022-08-15T15:52:08-05:00" itemprop="dateModified">
          Updated: Aug 15, 2022
        </time>
       • <span class="read-time" title="Estimated read time">
    
    
      1 min read
    
</span></p>    <style>
        .post-tool-bar{
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0px 10px 0px;
            /* border: 1px solid #e8e8e8; */
            border-width: 0px 0px 1px 0px;
        }
        .left-section , .right-section{
            display: flex;
            gap: 8px;
        }

    </style>
    
    <div class="post-tool-bar">
<!-- <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
        AOS.init();
</script> -->

<div class="tag-list">
    
    <a class="tag fa fa-hashtag reactive" href="/categories/#reactive">reactive</a>
    
    <a class="tag fa fa-hashtag spring-boot" href="/categories/#spring-boot">spring-boot</a>
    
</div>
<div class="right-section">
<a id="translate-btn" href="https://www.translatetheweb.com/?ref=TAns&from=&to=hi&a=https%3A%2F%2Fwww.ankushchoubey.com%2F">
    <img src="/images/icons/translate.svg" alt="Translate" style="width:35px">
</a>


<script>
    a = document.getElementById('translate-btn');
    a.setAttribute("href", "https://www.translatetheweb.com/?ref=TAns&from=&to=hi&a=" + window.location.href);
</script><a id="speech-btn">
    <img src="/images/icons/ear.svg" alt="listen" style="width:35px; cursor: pointer;">
</a>

<script>
    speakPost = () => {
        var msg = new SpeechSynthesisUtterance();
        const title = document.querySelector("h1.post-title.p-name").innerText;
        const post = document.querySelector("div.post-content.e-content").innerText
        msg.text = title + '.' + post;
        window.speechSynthesis.speak(msg);
    }
    if ('speechSynthesis' in window) {
        document.getElementById("speech-btn").addEventListener("click", speakPost);
    } else {
        document.getElementById('speech-btn').style.display = 'none';
    }
</script>

<!-- https://www.alebalweb-blog.com/85-text-to-speech-player-with-buttons-play-pause-stop-and-voice-choice.html -->
</div>
      
          
    </div>
    
</header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#use-blockhound-to-find-blocking-calls-during-testing">Use BlockHound to find blocking calls during testing</a></li>
<li class="toc-entry toc-h1"><a href="#avoid-significant-work-before-subscribe">Avoid Significant Work Before Subscribe</a></li>
<li class="toc-entry toc-h1">
<a href="#always-look-for-async-implementations">Always look for async implementations</a>
<ul>
<li class="toc-entry toc-h2"><a href="#encapsulate-blocking-calls">Encapsulate blocking calls</a></li>
<li class="toc-entry toc-h2"><a href="#find-if-a-method-is-reactive">Find if a method is reactive</a></li>
</ul>
</li>
</ul>
<p>The one rule you aren’t allowed to break with project reactor is this: Don’t Block over Event Loop!</p>

<p>Event loops are main threads that shouldn’t be blocked.</p>

<p>If there is a blocking code, they should be run on a separate thread.</p>

<p>Here are some ways to fix these issues that I have noted down while watching Avoiding Reactor Meldown video. I have added an additional tip at the end.</p>

<h2 id="use-blockhound-to-find-blocking-calls-during-testing">
<a class="anchor" href="#use-blockhound-to-find-blocking-calls-during-testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Use BlockHound to find blocking calls during testing</h2>

<p>BlockHound is a plugin provided by Project Reactor that helps find blocking calls.</p>

<p>If you are doing TDD, use junit version.</p>

<p>If you are aren’t doing TDD, use normal version but remove it in prod.</p>

<p>https://github.com/reactor/BlockHound</p>

<p>Remember that blockhound will only detect blocks on main thread. This means that if you are writing junit tests, if blocking call is not made on event loop, then it won’t be detected.</p>

<h1 id="avoid-significant-work-before-subscribe">
<a class="anchor" href="#avoid-significant-work-before-subscribe" aria-hidden="true"><span class="octicon octicon-link"></span></a>Avoid Significant Work Before Subscribe</h1>

<h1 id="always-look-for-async-implementations">
<a class="anchor" href="#always-look-for-async-implementations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Always look for async implementations</h1>

<p>Completable futures can be converted to mono. Many java libraries have completable future implementations.</p>

<h2 id="encapsulate-blocking-calls">
<a class="anchor" href="#encapsulate-blocking-calls" aria-hidden="true"><span class="octicon octicon-link"></span></a>Encapsulate blocking calls</h2>

<p><img src="https://trello.com/1/cards/62d3b3432dae600b8db5d7f4/attachments/62d585b52e381a43331ded5a/download/Screenshot_2022-07-17_at_12.23.22_PM.png" alt="Screenshot_2022-07-17_at_12.23.22_PM.png"></p>

<p><img src="https://trello.com/1/cards/62d3b3432dae600b8db5d7f4/attachments/62d585b266fbbc5ae9751808/download/Screenshot_2022-07-17_at_12.22.57_PM.png" alt="Screenshot_2022-07-17_at_12.22.57_PM.png"></p>

<h2 id="find-if-a-method-is-reactive">
<a class="anchor" href="#find-if-a-method-is-reactive" aria-hidden="true"><span class="octicon octicon-link"></span></a>Find if a method is reactive</h2>

<p><img src="https://trello.com/1/cards/62d3b3432dae600b8db5d7f4/attachments/62d5826d1010e7165d435b8c/download/Screenshot_2022-07-17_at_12.24.19_PM.png" alt="Screenshot_2022-07-17_at_12.24.19_PM.png"></p>

  </div>
  <!-- https://david.elbe.me/jekyll/2015/06/20/how-to-link-to-next-and-previous-post-with-jekyll.html -->

<div class="PageNavigation">
    
      <a class="prev" href="/dev-workflow/">« Ideal Development Workflow</a>
    
    
      <a class="next" href="/speeding-up-pipelines/">Speed up Pipelines »</a>
    
  </div>

<style>
    .PageNavigation {
  font-size: 14px;
  display: block;
  width: auto;
  overflow: hidden;
}

.PageNavigation a {
  display: block;
  width: 50%;
  float: left;
  margin: 1em 0;
}

.PageNavigation .next {
  text-align: right;
}
</style>
<!-- from https://github.com/utterance/utterances -->
<!-- <script src="https://utteranc.es/client.js"
        repo="ankschoubey/blog"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script> -->

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://www.ankushchoubey.com/encapsulate-blocking-reactive-way/';
      this.page.identifier = 'https://www.ankushchoubey.com/encapsulate-blocking-reactive-way/';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://ankushchoubey.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a class="u-url" href="/encapsulate-blocking-reactive-way/" hidden></a>
</article>
</head></html>
