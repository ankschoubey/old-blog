<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Make the database do the heavy lifting | Ankush Choubey</title>
<meta name="generator" content="Jekyll v4.1.1">
<meta property="og:title" content="Make the database do the heavy lifting">
<meta property="og:locale" content="en_US">
<meta name="description" content="You cannot compete with SQL">
<meta property="og:description" content="You cannot compete with SQL">
<link rel="canonical" href="https://www.ankushchoubey.com/sql_is_fast/">
<meta property="og:url" content="https://www.ankushchoubey.com/sql_is_fast/">
<meta property="og:site_name" content="Ankush Choubey">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-12-22T00:00:00-06:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Make the database do the heavy lifting">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-12-22T14:42:15-06:00","datePublished":"2019-12-22T00:00:00-06:00","description":"You cannot compete with SQL","headline":"Make the database do the heavy lifting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ankushchoubey.com/sql_is_fast/"},"url":"https://www.ankushchoubey.com/sql_is_fast/"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css">
<link type="application/atom+xml" rel="alternate" href="https://www.ankushchoubey.com/feed.xml" title="Ankush Choubey">
<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-35993343-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>



<script id="mcjs">!function(c,h,i,m,p){m=c.createElement(h),p=c.getElementsByTagName(h)[0],m.async=1,m.src=i,p.parentNode.insertBefore(m,p)}(document,"script","https://chimpstatic.com/mcjs-connected/js/users/787ccdfb3a0c625c1830ac78a/859c6d3b694fad02c3eff1603.js");</script><link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Make the database do the heavy lifting | Ankush Choubey</title>
<meta name="generator" content="Jekyll v4.1.1">
<meta property="og:title" content="Make the database do the heavy lifting">
<meta property="og:locale" content="en_US">
<meta name="description" content="You cannot compete with SQL">
<meta property="og:description" content="You cannot compete with SQL">
<link rel="canonical" href="https://www.ankushchoubey.com/sql_is_fast/">
<meta property="og:url" content="https://www.ankushchoubey.com/sql_is_fast/">
<meta property="og:site_name" content="Ankush Choubey">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2019-12-22T00:00:00-06:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Make the database do the heavy lifting">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2019-12-22T14:42:15-06:00","datePublished":"2019-12-22T00:00:00-06:00","description":"You cannot compete with SQL","headline":"Make the database do the heavy lifting","mainEntityOfPage":{"@type":"WebPage","@id":"https://www.ankushchoubey.com/sql_is_fast/"},"url":"https://www.ankushchoubey.com/sql_is_fast/"}</script>
<!-- End Jekyll SEO tag -->

<link href="https://unpkg.com/@primer/css/dist/primer.css" rel="stylesheet">
<link rel="stylesheet" href="//use.fontawesome.com/releases/v5.0.7/css/all.css">
<link type="application/atom+xml" rel="alternate" href="https://www.ankushchoubey.com/feed.xml" title="Ankush Choubey">
<!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-35993343-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>


    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.css" integrity="sha384-zB1R0rpPzHqg7Kpt0Aljp8JPLqbXI3bhnPWROx27a9N0Ll6ZP/+DiW/UqRcLbRjq" crossorigin="anonymous">
    <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/katex.min.js" integrity="sha384-y23I5Q6l+B6vatafAwxRu/0oK/79VlbSz7Q9aiSZUvyWYIYsd+qj+o24G5ZU2zJz" crossorigin="anonymous"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.1/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body>
<header class="site-header">

  <div class="wrapper">
<a class="site-title" rel="author" href="/">Ankush Choubey</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger">
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
            </svg>
          </span>
        </label>

        <div class="trigger">
<a class="page-link" href="/core-values-page/">Core Values</a><a class="page-link" href="/philosophy/">Philosophy</a><a class="page-link" href="/resume">Hire me!</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/tdd/">Test First Test Everything</a>
</div>
      </nav>
</div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <style>
  .page-content{
    padding-top: 0px;
  }
  .post-header{
    display: flex;
    flex-direction: column;
    justify-content: end;}

  .cover-image{
    position: absolute;
    left:0px;
    height: 300px;
    object-fit: cover;
    width: 100%;
  }

  @media screen and (max-width: 500px) {
    .post-header{}
    .cover-image{
      height: 550px;
    }
  }
  .post-header-content{}
</style>

<header class="post-header"><div class="post-header-content">
    <h1 class="post-title p-name" itemprop="name headline">Make the database do the heavy lifting</h1>
<p class="page-description">You cannot compete with SQL</p>
<p class="post-meta post-meta-title"><time class="dt-published" datetime="2019-12-22T00:00:00-06:00" itemprop="datePublished">
        Dec 22, 2019
      </time>
      • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>

    
    <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i>
      
      <a class="category-tags-link" href="/categories/#clean-code">clean-code</a>
      
      
    </p>
    

    </div>
</header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  
  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="rule-of-thumb-avoid-filtering-loops">Rule of thumb: Avoid filtering loops</h2>

<p>SQL/Databases are good at 2 jobs: storing data. filtering data as fast as possible. <strong>You’re for loop cannot compete with SQL.</strong></p>

<p>The performance of your program will be much faster if you let SQL manage the filtering of data. Plus it will also result in a smaller line of code.</p>

<p>Try to filter with smaller queries with a smaller number of columns before fetching all the columns. Smaller the data, the faster will be the data transfer. You will find a better example of this in the section of Complex Queries bellow.</p>

<h2 id="use-orm"><strong>Use ORM</strong></h2>

<p>For Spring (Java), ideally, use JPA method query things.<strong>***</strong></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/1.png" alt="Source: JPA Repositories Spring.io"></p>

<p>_Tips: Use tools to make Entities POJO</p>

<blockquote>
  <p>youtube: https://www.youtube.com/watch?v=LrbaDRcu3Y0</p>
</blockquote>

<p>For Python, SQLAlchemy is popular and preferred or Django ORM for Django. (I have less experience with this)</p>

<h2 id="complex-queries">Complex queries</h2>

<p>Native queries are faster than usual ones but use the sparingly.</p>

<p>In the case of Java, you can also JPA specific things like Specifications or Criteria API.</p>

<p>Honestly, I haven’t tried them I know they exist. I have seen them and found that the code looked really ugly</p>

<p>I do find Django ORM to be easier than Spring JPA (you can pass arguments rather than always create a separate function).</p>

<h3 id="break-down-big-bang-complex-queries-into-multiple-simpler-queries">Break down big-bang (complex) queries into multiple simpler queries</h3>

<blockquote>
  <p>note: This might be very controversial and I have not seen this talked about anywhere or used in other people’s code. <strong>You are not likely to use this unless you are like me (bad at ORMs)</strong>.</p>
</blockquote>

<p>Many times you have a complex feature like search and you want to filter by multiple parameters.</p>

<p>What usually ends up happening you end up with a custom query generator or Criteria API (Java) or a query which is too long. Especially if this query requires additional features like ordering and pagination.</p>

<p>I think a simpler solution is to break it into smaller queries. I give a simplified example below.</p>

<p>Note that this is a much simpler version of what you would encounter but I think it will make the point.</p>

<p>There are 3 tables:</p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/2.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/3.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/4.png" alt=""></p>

<p><strong><em>Suppose you want to find who are male grandparents of children whose name start with ‘A’</em></strong></p>

<p>You can go for some complex query like</p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/5.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/6.png" alt="Output"></p>

<p>These 33 lines can quickly increase in size when you have too many tables. Multiple shorter queries are always much better than one <strong>big bang query</strong>.</p>

<p>I’ve seen queries which go beyond 100 lines 😖</p>

<p><strong>Making changes in such large 100+ line queries is a pain.</strong></p>

<p>(Even when writing the 33 line query above, I introduced bug by not writing join on lines 30 and 31. writing smaller queries helped me debug.)</p>

<p>You could break into something simpler queries like:</p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/7.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/8.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/9.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/10.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/11.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/12.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/13.png" alt=""></p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/14.png" alt=""></p>

<p>Then code the method yourself to call these in a certain sequence:</p>

<p><img src="/images/2019-12-22-clean-code-4-make-the-database-do-the-heavy-lifting/15.png" alt=""></p>

<p>You will find that even though your line of code has increased, the modularity of code has also increased and these functions can be arranged in any way you like.</p>

<hr>

<p><strong>Previous</strong>: <a href="/clean%20code/2019/12/25/clean-code-3-avoid-creating-god-classes-and-long-methods.html">Avoid creating god classes and long methods</a></p>

<p><strong>Next</strong>: <a href="https://medium.com/p/c477707e5be1">Remove unnecessary code</a></p>

<p><strong>Index</strong>: <a href="/software%20development/clean%20code/2019/12/19/series-tips-on-writing-clean-code.html">Tips on writing Clean Code</a></p>

  </div>
  <div id="mc_embed_shell">
    <link href="//cdn-images.mailchimp.com/embedcode/classic-061523.css" rel="stylesheet" type="text/css">
<style type="text/css">
      #mc_embed_signup{background:#fff; false;clear:left; font:14px Helvetica,Arial,sans-serif; width: 600px;}
      /* Add your own Mailchimp form style overrides in your site stylesheet or in this style block.
         We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
    <img src="/images/signup-homescreen.png" style="background: #0000ff00;max-height: 150px;">
    <a style="font-size: 1px;" href="https://www.freepik.com/free-vector/hacker-operating-laptop-cartoon-icon-illustration-technology-icon-concept-isolated-flat-cartoon-style_11602236.htm#query=programmer&amp;position=1&amp;from_view=search&amp;track=sph">Image by catalyststuff  on Freepik</a>
  <form action="https://ankushchoubey.us21.list-manage.com/subscribe/post?u=787ccdfb3a0c625c1830ac78a&id=51f57ce68a&f_id=002959e1f0" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank">
    <p style="display: flex;margin: 0px !important;gap: 10px;">
        Hire me for consulting, speaking and developer roles by contacting me on <a href="https://www.linkedin.com/in/ankushchoubey/"><img src="/images/LI-Logo.png" style="height: 2ch;    background: #f0f8ff00;" alt="LinkedIn logo"></a>.
    </p>  
    <div id="mc_embed_signup_scroll">
<p>For more articles like this one, subcribe to my email newsletter for captivating articles at the crossroads of Software Engineering and Philosophy.</p>
          <div class="indicates-required" style="display: none;">
<span class="asterisk">*</span> indicates required</div>
          <div class="mc-field-group">
<label for="mce-EMAIL">Email Address <span class="asterisk">*</span></label><input type="email" name="EMAIL" class="required email" id="mce-EMAIL" required="" value=""><span id="mce-EMAIL-HELPERTEXT" class="helper_text"></span>
</div>
      <div id="mce-responses" class="clear foot">
          <div class="response" id="mce-error-response" style="display: none;"></div>
          <div class="response" id="mce-success-response" style="display: none;"></div>
      </div>
  <div aria-hidden="true" style="position: absolute; left: -5000px;">
      /* real people should not fill this in and expect good things - do not remove this or risk form bot signups */
      <input type="text" name="b_787ccdfb3a0c625c1830ac78a_51f57ce68a" tabindex="-1" value="">
  </div>
      <div class="optionalParent">
          <div class="clear foot">
              <input type="submit" name="subscribe" id="mc-embedded-subscribe" class="button" value="Subscribe">
              <p class="brandingLogo" style="margin: 0px auto;"><a href="http://eepurl.com/iwHRjY" title="Mailchimp - email marketing made easy and fun"><img src="https://eep.io/mc-cdn-images/template_images/branding_logo_text_dark_dtp.svg" alt="referral badge"></a></p>
          </div>
      </div>
  </div>
</form>
</div>
<script type="text/javascript" src="//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js"></script><script type="text/javascript">(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';fnames[3]='ADDRESS';ftypes[3]='address';fnames[4]='PHONE';ftypes[4]='phone';fnames[5]='BIRTHDAY';ftypes[5]='birthday';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
</div>

<style>
div#mc_embed_signup{
    width: auto !important;
    display: flex;
    justify-content: center;
    align-content: center;
}
form#mc_embed_signup{
    max-width: 800px !important;
}
#mc_embed_signup{
    background-color: #fff0 !important;
}
#mc_embed_signup .mc-field-group{
    padding-bottom: 0% !important;
}

#mc_embed_signup h2{
    margin: 0px !important;
}
#mc_embed_signup .brandingLogo{
    display: none !important;
}
</style>
<div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://www.ankushchoubey.com/sql_is_fast/';
      this.page.identifier = 'https://www.ankushchoubey.com/sql_is_fast/';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://ankushchoubey.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a class="u-url" href="/sql_is_fast/" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="https://www.ankushchoubey.com/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>Full Stack Developer - Cloud/Microservices</p>
      </div>
    </div>

    <div class="social-links">
<ul class="social-media-list">
<li>
  <a rel="me" href="https://github.com/ankschoubey" target="_blank" title="github">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#github"></use>
    </svg>
  </a>
</li>
<li>
  <a rel="me" href="https://twitter.com/ankschoubey" target="_blank" title="twitter">
    <svg class="svg-icon grey">
      <use xlink:href="/assets/minima-social-icons.svg#twitter"></use>
    </svg>
  </a>
</li>
</ul>
</div>

  </div>

</footer>
</body>

</html>
