<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "http://www.w3.org/TR/REC-html40/loose.dtd">
<!-- <script>
  for (const iterator of document.getElementsByClassName('page-link')) {
      if (iterator.innerHTML === 'Search'){ iterator.classList.add('search-button'); iterator.title = 'Search';}
      if (iterator.innerHTML === 'Tags'){ iterator.classList.add('tags-button'); iterator.title = 'Tags';}
      if (iterator.innerHTML === 'Side Projects'){ iterator.classList.add('side-project-button'); iterator.title = 'Side Projects';}
  }
</script> --><html><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<script type="text/javascript" src="/assets/accordian.js"></script>

<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Separating_request,_entity_and_response</h1>

    <p class="post-meta post-meta-title"><time class="dt-published post-meta-created-date" datetime="2023-01-07T00:00:00-06:00" itemprop="datePublished">
        Written: Jan 7, 2023
      </time>~<time class="dt-modified post-meta-last-modified-date" datetime="2023-03-03T10:42:11-06:00" itemprop="dateModified">
          Updated: Mar 3, 2023
        </time>
       • <span class="read-time" title="Estimated read time">
    
    
      2 min read
    
</span></p>    <style>
        .post-tool-bar{
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0px 10px 0px;
            /* border: 1px solid #e8e8e8; */
            border-width: 0px 0px 1px 0px;
        }
        .left-section , .right-section{
            display: flex;
            gap: 8px;
        }

    </style>
    
    <div class="post-tool-bar">
<!-- <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
        AOS.init();
</script> -->
<div class="right-section">
<a id="translate-btn" href="https://www.translatetheweb.com/?ref=TAns&from=&to=hi&a=https%3A%2F%2Fwww.ankushchoubey.com%2F">
    <img src="/images/icons/translate.svg" alt="Translate" style="width:35px">
</a>


<script>
    a = document.getElementById('translate-btn');
    a.setAttribute("href", "https://www.translatetheweb.com/?ref=TAns&from=&to=hi&a=" + window.location.href);
</script><a id="speech-btn">
    <img src="/images/icons/ear.svg" alt="listen" style="width:35px; cursor: pointer;">
</a>

<script>
    speakPost = () => {
        var msg = new SpeechSynthesisUtterance();
        const title = document.querySelector("h1.post-title.p-name").innerText;
        const post = document.querySelector("div.post-content.e-content").innerText
        msg.text = title + '.' + post;
        window.speechSynthesis.speak(msg);
    }
    if ('speechSynthesis' in window) {
        document.getElementById("speech-btn").addEventListener("click", speakPost);
    } else {
        document.getElementById('speech-btn').style.display = 'none';
    }
</script>

<!-- https://www.alebalweb-blog.com/85-text-to-speech-player-with-buttons-play-pause-stop-and-voice-choice.html -->
</div>
      
          
    </div>
    
</header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><a href="https://drive.google.com/drive/folders/1tsu2S_EnDds8oIRiiip4rwl2qhXEq-Se?usp=sharing"><span class="underline">https://drive.google.com/drive/folders/1tsu2S_EnDds8oIRiiip4rwl2qhXEq-Se?usp=sharing</span></a></p>

<p>Security is a major concern for web applications. One of the ways to achieve this is by using the least access principle. This means only exposing things that are necessary and hiding the rest.</p>

<p>In a typical web application, we perform CRUD operations on entities.</p>

<p>It’s quite common to have the same entity object be requested, saving to DB and response.</p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image2.png" alt=""></p>

<p>Here are the roles of classes mentioned above,</p>

<ul>
  <li>
    <blockquote>
      <p>API endpoints: deals with input objects. In this case, a single one entity.</p>
    </blockquote>
  </li>
  <li>
    <blockquote>
      <p>Service and Repository: deal with manipulating and saving entities to the database. And sending the same entity as response.</p>
    </blockquote>
  </li>
  <li>
    <blockquote>
      <p>Entity: Has 3 roles. Input Object, Output Object and being object stored in database.</p>
    </blockquote>
  </li>
</ul>

<p><em>Code Sample:</em></p>

<p><strong><em>Entity</em></strong></p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image5.png" alt=""></p>

<p><strong>Repository</strong>:</p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image4.png" alt=""></p>

<p><strong>Controller</strong>:<br>
<img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image7.png" alt=""></p>

<p>This way is problematic since it,</p>

<ul>
  <li>
    <blockquote>
      <p>Many fields used for one role (like input) won’t be used for other role (like storing to DB)</p>
    </blockquote>
  </li>
  <li>
    <blockquote>
      <p>Internal details are exposed in output</p>
    </blockquote>
  </li>
  <li>
    <blockquote>
      <p>Validations are harder for inputs</p>
    </blockquote>
  </li>
</ul>

<p>Many linters recommend having a separate DTO object for this task. This is a step up over the usual entity but isn’t sufficient as most of the time the entity and DTO are exact replicas of each other.</p>

<p>There is a better alternative to this, which is to separate inputs, output and entity classes entirely..</p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image3.png" alt=""></p>

<p><em>Code Sample:</em></p>

<p><strong><em>Request Object:</em></strong></p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image6.png" alt=""></p>

<p><strong>Empty Body Response:</strong></p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image8.png" alt=""></p>

<p><strong>Response With Body:</strong></p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image1.png" alt=""></p>

<p><strong>Response Assembler:</strong></p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image9.png" alt=""></p>

<p><strong>Controller:</strong></p>

<p><img src="https://www.ankushchoubey.com/assets/img/2023-01-07-Separating_Request,_Entity_and_Response/media/image10.png" alt=""><br>
As you can see from the example above, there are many request objects and a single response object. Each of these requests and responses can have different fields.</p>

<p><strong>API endpoint</strong>: deals with getting different formats.</p>

<p><strong>Service &amp; Repository</strong>: only deal with manipulating entity files based on the type of request. It then either sends a response directly if there is no body or offloads it’s work to a response assembler.</p>

<p><strong>Response Assembler</strong>: job is to create a response. There may be multiple types of responses which response assembler may assemble</p>

<p>There can also be requests and responses that have no body at all.</p>

<p>For example:</p>

<ul>
  <li>
    <blockquote>
      <p>Request params maybe enough for GET and DELETE request</p>
    </blockquote>
  </li>
  <li>
    <blockquote>
      <p>Similarly, HTTP status code and response header maybe enough for responses</p>
    </blockquote>

    <ul>
      <li>
        <blockquote>
          <p>If an object is created, then 201 CREATED with response headers like location without a body may be enough.</p>
        </blockquote>
      </li>
    </ul>
  </li>
</ul>

<p>HTTP suggests but does not enforce any kind of rules over requests and responses. But by following them as closely as possible, we can ensure communicating intent without transfer of bulky.</p>

<p>The benefits of this approach is:</p>

<ol>
  <li>
    <blockquote>
      <p>Request, Response and Entity classes have a clear separation of concern. Each deal with their own specific usage.</p>
    </blockquote>
  </li>
  <li>
    <blockquote>
      <p>Therefore, no extra fields are added to each. If new fields are to be added to one part, they may or may not concern other parts.</p>
    </blockquote>
  </li>
  <li>
    <blockquote>
      <p>Securing the application becomes easier as less internal details are leaked.</p>
    </blockquote>
  </li>
</ol>

<p>PS: Tip: In most cases, the response object requires some fields from the entity. Commonly DTOs are created and data from entities is copied to response using some sort of mapper. There is a better alternative which is to use the Delegate pattern. The getters of response class can delegate to getters of entity class. In Java specifically, this can be made easier by using Lombok’s @Delegate annotation.</p>

  </div>
  <!-- https://david.elbe.me/jekyll/2015/06/20/how-to-link-to-next-and-previous-post-with-jekyll.html -->

<div class="PageNavigation">
    
      <a class="prev" href="/v1/observability-for-developers">« Observability For Developers</a>
    
    
      <a class="next" href="/v1/template-for-gherkin-specs">Template for Gherkin Specs »</a>
    
  </div>

<style>
    .PageNavigation {
  font-size: 14px;
  display: block;
  width: auto;
  overflow: hidden;
}

.PageNavigation a {
  display: block;
  width: 50%;
  float: left;
  margin: 1em 0;
}

.PageNavigation .next {
  text-align: right;
}
</style>

  <div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://www.ankushchoubey.com/2023/01/07/Separating_Request,_Entity_and_Response.html';
      this.page.identifier = 'https://www.ankushchoubey.com/2023/01/07/Separating_Request,_Entity_and_Response.html';
    };
    (function() {
      var d = document, s = d.createElement('script');
      s.src = 'https://ankushchoubey.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
</noscript>
<a class="u-url" href="/2023/01/07/Separating_Request,_Entity_and_Response.html" hidden></a>
</article>
</head></html>
